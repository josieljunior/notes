<p style="color: green"><%= notice %></p>

<% content_for :title, "Memos" %>

<h1>Memos</h1>

<div class="archive-toggle">
  <% if @show_archived %>
    <%= link_to "Ver Memos Ativos", memos_path, class: "archive-link" %>
  <% else %>
    <%= link_to "Ver Memos Arquivados", memos_path(archived: true), class: "archive-link" %>
  <% end %>
</div>

<div class="search-form">
  <%= form_with url: memos_path, method: :get, local: true do |form| %>
    <%= form.text_field :search, placeholder: "Pesquisar por título ou conteúdo...", value: params[:search] %>
    <%= form.submit "Pesquisar" %>
    <% if params[:search].present? %>
      <%= link_to "Limpar", memos_path %>
    <% end %>
  <% end %>
</div>

<% if @tags.any? %>
  <div class="tags-filter">
    <h3>Filtrar por tags:</h3>
    <% @tags.each do |tag| %>
      <%= link_to tag.name, memos_path(tag: tag.name), class: "tag-filter #{'active' if params[:tag] == tag.name}" %>
    <% end %>
    <% if params[:tag].present? %>
      <%= link_to "Todas", memos_path, class: "tag-filter clear" %>
    <% end %>
  </div>
<% end %>

<div id="memos">
  <% if params[:search].present? %>
    <p><strong>Resultados para:</strong> "<%= params[:search] %>" (<%= @memos.count %> <%= @memos.count == 1 ? 'resultado' : 'resultados' %>)</p>
  <% elsif params[:tag].present? %>
    <p><strong>Memos com a tag:</strong> "<%= params[:tag] %>" (<%= @memos.count %> <%= @memos.count == 1 ? 'memo' : 'memos' %>)</p>
  <% elsif @show_archived %>
    <p><strong>Memos Arquivados:</strong> (<%= @memos.count %> <%= @memos.count == 1 ? 'memo' : 'memos' %>)</p>
  <% else %>
    <p><strong>Memos Ativos:</strong> (<%= @memos.count %> <%= @memos.count == 1 ? 'memo' : 'memos' %>)</p>
  <% end %>
  <% @memos.each do |memo| %>
    <%= render memo %>
    <p>
      <%= link_to "Ver", memo %> |
      <%= link_to "Editar", edit_memo_path(memo) %> |
      <% if memo.archived? %>
        <%= button_to "Desarquivar", unarchive_memo_path(memo), method: :patch, class: "unarchive-button", data: { confirm: "Tem certeza que deseja desarquivar este memo?" } %> |
      <% else %>
        <%= button_to "Arquivar", archive_memo_path(memo), method: :patch, class: "archive-button", data: { confirm: "Tem certeza que deseja arquivar este memo?" } %> |
      <% end %>
      <%= link_to "Excluir", memo, method: :delete, data: { confirm: "Tem certeza?" } %>
    </p>
  <% end %>
</div>

<%= link_to "New memo", new_memo_path %>
